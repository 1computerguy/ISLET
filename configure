#!/usr/bin/env bash
# This isn't a configure generated by autoconf!
# ISLET build system
# Copyright 2014 Jon Schipp <jonschipp@gmail.com>
# Subject to the GNU GPL

# Global Declarations
OK=0
CRITICAL=1
DEPENDS="bash make sshd docker"
MISSING=()

# set default values for the thresholds
usage()
{
cat <<EOF

Configure ISLET

     Options:
     -p|--prefix <path>		Installation directory (def: /opt/islet)
     -h|--help			Print this help message

Usage: $0 --prefix /opt/islet
EOF
}

check_linux()
{
        echo -n "[*] Checking Linux ... "

        if [[ "$(uname)" != "Linux" ]] ; then
                echo "[NO] Linux not found"
		MISSING+=('Linux')
        else
                echo "[YES] Linux found"
        fi
}

check_dependencies()
{
	local depends=$1
        echo -n "[*] Checking $depends ... "

        if [[ "x$(which $depends 2>/dev/null)" == "x" ]] ; then
                echo "[NO] $depends not found"
		MISSING+=("$depends")
        else
                echo "[YES] $depends found"
        fi
}


#if [ "$#" -gt 0 ]
#then
#	while true
#	do
#        	case $1 in
#			-p|--prefix) shift; PREFIX="$1";;
#                	-h|--help) usage; exit;;
#        	esac
#	done
#fi

check_linux

for i in $DEPENDS
do
	check_dependencies $i
done

if [ ${#MISSING[@]} -gt 2 ];
then
	count=$(echo ${#MISSING[@]})
	echo -n "[!] Missing dependencies: "
	for (( i=0; i<${count}; i++ ));
	do
  		echo -n "${MISSING[$i]} "
	done
	exit $CRITICAL
else
	echo "[=] All dependencies found, now you can run \`\`make install''"
fi
