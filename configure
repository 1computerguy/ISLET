#!/usr/bin/env bash
# This isn't a configure generated by autoconf!
# ISLET build system
# Copyright 2014 Jon Schipp <jonschipp@gmail.com>
# Subject to the GNU GPL

# Global Declarations
OK=0
CRITICAL=1
DEPENDS="bash make sshd docker"
MISSING=()

check_linux()
{
        echo -n "[*] Checking Linux ... "

        if [[ "$(uname)" != "Linux" ]] ; then
                echo "[NO] Linux not found"
		MISSING+=('Linux')
        else
                echo "[YES] Linux found"
        fi
}

check_dependencies()
{
	local depends=$1
        echo -n "[*] Checking $depends ... "

        if [[ "x$(which $depends 2>/dev/null)" == "x" ]] ; then
                echo "[NO] $depends not found"
		MISSING+=("$depends")
        else
                echo "[YES] $depends found"
        fi
}

check_linux

for i in $DEPENDS
do
	check_dependencies $i
done

if [ ${#MISSING[@]} -gt 0 ];
then
	count=$(echo ${#MISSING[@]})
	echo -n "[!] Missing dependencies: "
	for (( i=0; i<${count}; i++ ));
	do
  		echo -n "${MISSING[$i]} "
	done
	exit $CRITICAL
else
	echo "[=] All dependencies found, now you can run \`\`make install''"
fi
