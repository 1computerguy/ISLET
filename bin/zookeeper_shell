#!/usr/bin/env bash
# Global Variables
CONFIG=LOCATION
COUNT=0
if [ -f $CONFIG ]; then
	source $CONFIG
	source $LIBZK
else
	echo "Error: ${CONFIG:-config} or ${LIBZK:-libzk} not found!"
	exit 1
fi

clear

if [ -d $CONFIG_DIR ]
then
        cd $CONFIG_DIR
else
        echo "Error: $CONFIG_DIR doesn't exist!"
        exit 1
fi

# Zookeeper Banner
cat <<EOF
${B}Welcome to Zookeeper!${N}

${MF}==============================================${N}

   ${BF}Zoo Keeper${N}${RF}:${N} ${Y}A Linux-based Training System${N}

   ${BF}Web${N}${RF}:${N} ${U}${Y}https://github.com/jonschipp/zookeeper${N}

${MF}==============================================${N}

${B}A place to try out Linux software.${N}

EOF

# Press key to continue
echo -e "${Y}.${N}${RF}.${N}${BF}.${N}Press any key to continue or CTRL+C to exit${Y}.${N}${RF}.${N}${BF}.${N}\n"
read -rs -n1 key
clear
echo

# Configuration menu
notice "\t\t\t\tAvailable configurations:\n"
printf '\t\t\t%-29s %-7s %-30s\n' "${B}Configuration${N}" "|" "${B}Description${N}"
printf '\t\t\t%-30s %-7s %-30s\n' "${BF}$SPACER1${N}" "|" "${BF}$SPACER1${N}"
for config in *.conf
do
        source $config
        printf '\t\t\t%-30s %-7s %-30s\n' "${WF}$config${N}" "|" "${U}$DESCRIPTION${N}"
done

while test $COUNT -lt $FAILURE_COUNT
do
        read -r -p "Choice: " CONFIGURATION
        if [ -f "$CONFIG_DIR/$CONFIGURATION" ]; then
                break
        else
                echo "Invalid choice!"
        fi
        let COUNT++

        if [ $COUNT -ge $FAILURE_COUNT ]; then
                log "Too many failed attempts!"
        fi
done

####################################################
exec timeout 1m "$LAUNCH_CONTAINER" "$CONFIGURATION"
####################################################
